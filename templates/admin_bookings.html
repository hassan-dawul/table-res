{% extends "base.html" %}
{% block title %}ğŸ“‹ Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø·Ø§Ø¹Ù… - Ø§Ù„Ø£Ø¯Ù…Ù†{% endblock %}

{% block content %}
<section class="py-5">
  <div class="container">
    <h2 class="mb-4 text-center" id="bookings-title">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>

    <div class="table-responsive">
      <table class="table table-bordered table-striped text-center align-middle" id="bookings-table">
        <thead class="table-primary">
          <tr>
            <th id="table-id">Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²</th>
            <th id="table-restaurant">Ø§Ù„Ù…Ø·Ø¹Ù…</th>
            <th id="table-user">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
            <th id="table-date">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th id="table-time">Ø§Ù„ÙˆÙ‚Øª</th>
            <th id="table-people">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ</th>
            <th id="table-status">Ø§Ù„Ø­Ø§Ù„Ø©</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="7" id="loading-text">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø®ÙÙŠØ© -->
<p class="d-none" id="status-confirmed">Ù…Ø¤ÙƒØ¯</p>
<p class="d-none" id="status-cancelled">Ù…Ù„ØºÙŠ</p>
<p class="d-none" id="status-pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"</p>
<p class="d-none" id="no-bookings">ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
<p class="d-none" id="error-loading-bookings">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª.</p>

<script>
document.addEventListener("DOMContentLoaded", async () => {
    const tableBody = document.querySelector("#bookings-table tbody");

    async function loadBookings() {
        tableBody.innerHTML = `<tr><td colspan="7">${document.getElementById('loading-text')?.textContent || 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...'}</td></tr>`;
        try {
            const lang = localStorage.getItem('site-lang') || 'ar';
            const token = localStorage.getItem('admin-token'); // Ø£Ùˆ Ø§Ø¬Ù„Ø¨Ù‡ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
            const res = await fetch(`/api/admin/bookings?lang=${lang}`, {
                credentials: "same-origin",
                headers: { "Authorization": `Bearer ${token}` }
            });
            if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
            const result = await res.json();

            if (!result.data || result.data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="7">${document.getElementById('no-bookings')?.textContent}</td></tr>`;
                return;
            }

            const statusTranslation = {
                "confirmed": document.getElementById('status-confirmed')?.textContent || "Ù…Ø¤ÙƒØ¯",
                "cancelled": document.getElementById('status-cancelled')?.textContent || "Ù…Ù„ØºÙŠ",
                "pending": document.getElementById('status-pending')?.textContent || "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"
            };

            tableBody.innerHTML = "";
            result.data.forEach(b => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${b.id}</td>
                    <td>${b.restaurant_name}</td>
                    <td>${b.user_name}</td>
                    <td>${b.date}</td>
                    <td>${b.time}</td>
                    <td>${b.people}</td>
                    <td>${statusTranslation[b.status] || b.status}</td>
                `;
                tableBody.appendChild(row);
            });
        } catch (err) {
            console.error(err);
            tableBody.innerHTML = `<tr><td colspan="7" class="text-danger">${document.getElementById('error-loading-bookings')?.textContent}</td></tr>`;
        }
    }

    loadBookings();
});
</script>
{% endblock %}
